# Orkestrasyon ve Docker Compose

Tek bir konteyneri (şarkıcıyı) yönetmek kolaydır, ancak gerçek dünyada uygulamalar bir orkestra gibidir; birden fazla parçanın (Web, API, Veritabanı, Önbellek) uyum içinde çalışması gerekir.

## 1. Sorun: "Manuel Yönetim Kaosu"

Sizin bir veteriner SaaS projeniz var diyelim. Bu proje çalışırken muhtemelen şunlara ihtiyaç duyacak:

- **.NET API** (Backend)
- **React Uygulaması** (Frontend)
- **PostgreSQL** (Veritabanı)
- **Redis** (SignalR ve Cache için)

Bunların hepsini tek tek `docker run ...` komutlarıyla başlatmak, ağ ayarlarını yapmak ve birbirine bağlamak tam bir kâbustur.

## 2. Çözüm: Docker Compose (Orkestra Şefi)

Docker Compose, tüm bu servisleri tek bir dosyada (`docker-compose.yml`) tanımlamanızı ve tek bir komutla hepsini birden ayağa kaldırmanızı sağlar.

## 3. Pratik Örnek: Web + Veritabanı

Projenizin ana dizininde `docker-compose.yml` adında bir dosya oluşturduğunuzu düşünün. İçeriği şöyle görünür:

```yaml
version: '3.8'  # Versiyon

services:
  # 1. Servis: Sizin Web Uygulamanız
  veteriner-api:
    build: .             # "Bulunduğum klasördeki Dockerfile'ı kullan"
    ports:
      - "5000:80"        # Dışarıdan 5000'e gelen, içeri 80'e gitsin
    depends_on:
      - veritabani       # "Veritabanı açılmadan beni başlatma"

  # 2. Servis: Veritabanı (Hazır Image)
  veritabani:
    image: postgres:15   # Resmi Postgres imajını indir
    environment:
      POSTGRES_PASSWORD: gizlisifre # Ortam değişkenleri (Environment Variables)
    volumes:
      - db-data:/var/lib/postgresql/data # KALICILIK (Aşağıda açıklayacağım)

# Verilerin saklanacağı depo tanımı
volumes:
  db-data:
```

## 4. Kritik Kavram: Volumes (Veri Kalıcılığı)

Docker konteynerleri doğası gereği **geçicidir** (ephemeral).

### Sorun
Veritabanı konteynerini silerseniz veya yeniden başlatırsanız, içindeki tüm hasta kayıtları, randevular silinir.

### Çözüm (Volumes)
Yukarıdaki `volumes` satırı şunu der: "Postgres'in verileri yazdığı klasörü (`/var/lib/...`), benim bilgisayarımda güvenli bir alana (`db-data`) bağla."

### Sonuç
Konteyneri silseniz, patlatsanız bile verileriniz (Volume) bilgisayarınızda güvende kalır. Yeni konteyner açtığınızda kaldığı yerden devam eder.

## 5. Sihirli Komutlar

Artık 4-5 tane terminal açmanıza gerek yok.

### Başlat
```bash
docker-compose up -d
```
(Tüm orkestrayı arka planda başlatır. Veritabanını kurar, ağları ayarlar, API'yı bağlar.)

### Durdur ve Sil
```bash
docker-compose down
```
(Tüm konteynerleri durdurur ve temizler. Volumes hariç!)